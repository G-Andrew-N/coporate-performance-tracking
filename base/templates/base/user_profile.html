{% extends 'main.html' %}

{% block content %}
<style>
    canvas {
        max-width: 400px;  /* Adjust width */
        max-height: 300px; /* Adjust height */
        margin: auto;      /* Center the charts */
        display: block;
    }
</style>
    <div class="container">
        <h1>{{ user.get_full_name }}</h1>
        <h2>Role: {{ employee.role }}</h2>
        <h3>Performance Score: {{ employee.performance_score }}</h3>
        <h3>Join Date: {{ employee.join_date }}</h3>

        <section>
            <h2>Performance Summary</h2>
            <p><strong>Tasks Completed:</strong> {{ performance_metrics.tasks_completed|default:"N/A" }}</p>
            <p><strong>Sales Closed:</strong> {{ performance_metrics.sales_closed|default:"N/A" }}</p>
        </section>

        <section>
            <h2>Task Status Overview</h2>
            <canvas id="taskStatusChart"></canvas>
        </section>

        <section>
            <h2>Profit Trends</h2>
            <canvas id="profitTrendChart"></canvas>
        </section>

        <section>
            <h2>Recent Sales</h2>
            {% if sales %}
                <ul>
                    {% for sale in sales %}
                        <li>{{ sale.property }} - ${{ sale.sale_price }} ({{ sale.transaction_status }})</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No recent sales.</p>
            {% endif %}
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // ðŸš€ Task Status Pie Chart
            let taskStatusCtx = document.getElementById("taskStatusChart").getContext("2d");
            let taskStatusData = {{ task_status_counts|default:"[]"|safe }};

            if (taskStatusData.length > 0) {
                new Chart(taskStatusCtx, {
                    type: "pie",
                    data: {
                        labels: ["Pending", "Completed", "Overdue"],
                        datasets: [{
                            label: "Task Status",
                            data: taskStatusData,
                            backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56"],
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: "bottom" },
                            tooltip: { enabled: true }
                        }
                    }
                });
            }

            // ðŸš€ Agent Profit Trend Chart
            let profitCtx = document.getElementById("profitTrendChart").getContext("2d");
            let profitLabels = {{ profit_data.labels|default:"[]"|safe }};
            let profitValues = {{ profit_data.profit_values|default:"[]"|safe }};

            if (profitLabels.length > 0 && profitValues.length > 0) {
                new Chart(profitCtx, {
                    type: "line",
                    data: {
                        labels: profitLabels,
                        datasets: [{
                            label: "Profit Amount ($)",
                            data: profitValues,
                            borderColor: "rgba(255, 99, 132, 1)",
                            backgroundColor: "rgba(255, 99, 132, 0.2)",
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: "rgba(200, 200, 200, 0.2)" }
                            }
                        },
                        plugins: {
                            tooltip: { enabled: true },
                            legend: { display: false }
                        }
                    }
                });
            }
        });
    </script>
{% endblock %}
