{% extends 'main.html' %}

{% block content %}
<style>
/* Container Layout */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    background-color: #f7fafc;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Header Hierarchy */
.container h1 {
    color: #1a365d;
    font-size: 2.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.container h2 {
    color: #2c5282;
    font-size: 1.5rem;
    font-weight: 500;
    margin: 0.5rem 0;
}

.container h3 {
    color: #4a5568;
    font-size: 1.25rem;
    font-weight: 500;
    margin: 0.5rem 0 1.5rem;
}

/* Section Styling */
section {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    margin-bottom: 2rem;
}

section h2 {
    margin-top: 0;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #e2e8f0;
}

/* Performance Summary */
section p {
    margin: 0.75rem 0;
    font-size: 1.125rem;
    color: #4a5568;
}

section p strong {
    color: #2d3748;
    font-weight: 600;
    margin-right: 0.5rem;
}

/* Chart Containers */
canvas {
    background-color: white;
    padding: 1rem;
    border-radius: 0.375rem;
    margin: 1rem auto;
}

/* Sales List */
section ul {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
}

section li {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #e2e8f0;
    color: #4a5568;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

section li:last-child {
    border-bottom: none;
}

/* Transaction Status Styles */
.transaction-pending {
    color: #d69e2e;
    font-weight: 500;
}

.transaction-completed {
    color: #38a169;
    font-weight: 500;
}

.transaction-failed {
    color: #e53e3e;
    font-weight: 500;
}

/* Performance Score Highlight */
h3:contains("Performance Score") {
    background: linear-gradient(to right, #4299e1, #2b6cb0);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    display: inline-block;
}

/* Chart Responsiveness */
@media (max-width: 768px) {
    .container {
        padding: 1rem;
    }

    canvas {
        max-width: 100% !important;
        height: auto !important;
    }

    section {
        padding: 1rem;
    }

    .container h1 {
        font-size: 1.75rem;
    }

    .container h2 {
        font-size: 1.25rem;
    }

    .container h3 {
        font-size: 1.125rem;
    }
}

/* Empty State Styling */
section:empty::before {
    content: "No data available";
    display: block;
    text-align: center;
    color: #718096;
    font-style: italic;
    padding: 2rem;
}

/* Chart Loading State */
canvas:empty::before {
    content: "Loading chart...";
    display: block;
    text-align: center;
    color: #718096;
    padding: 2rem;
}

/* Hover Effects */
section li:hover {
    background-color: #f7fafc;
    transition: background-color 0.2s ease;
}

/* Print Styles */
@media print {
    .container {
        background: white;
        padding: 0;
    }

    section {
        box-shadow: none;
        border: 1px solid #e2e8f0;
        break-inside: avoid;
    }

    canvas {
        max-width: 100% !important;
        height: auto !important;
    }
}
</style>
    <div class="container">
        <h1>{{ user.get_full_name }}</h1>
        <h2>Role: {{ employee.role }}</h2>
        <h3>Performance Score: {{ PerformanceMetrics.aggregatepoints }}</h3>
        <h3>Join Date: {{ employee.join_date }}</h3>

        <section>
            <h2>Performance Summary</h2>
            <p><strong>Tasks Completed:</strong> {{ performance_metrics.tasks_completed|default:"N/A" }}</p>
            <p><strong>Sales Closed:</strong> {{ performance_metrics.sales_closed|default:"N/A" }}</p>
        </section>

        <section>
            <h2>Task Status Overview</h2>
            <canvas id="taskStatusChart"></canvas>
        </section>

        <section>
            <h2>Profit Trends</h2>
            <canvas id="profitTrendChart"></canvas>
        </section>

        <section>
            <h2>Recent Sales</h2>
            {% if sales %}
                <ul>
                    {% for sale in sales %}
                        <li>{{ sale.property }} - ${{ sale.sale_price }} ({{ sale.transaction_status }})</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No recent sales.</p>
            {% endif %}
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // ðŸš€ Task Status Pie Chart
            let taskStatusCtx = document.getElementById("taskStatusChart").getContext("2d");
            let taskStatusData = {{ task_status_counts|default:"[]"|safe }};

            if (taskStatusData.length > 0) {
                new Chart(taskStatusCtx, {
                    type: "pie",
                    data: {
                        labels: ["Pending", "Completed", "Overdue"],
                        datasets: [{
                            label: "Task Status",
                            data: taskStatusData,
                            backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56"],
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: "bottom" },
                            tooltip: { enabled: true }
                        }
                    }
                });
            }

            // ðŸš€ Agent Profit Trend Chart
            let profitCtx = document.getElementById("profitTrendChart").getContext("2d");
            let profitLabels = {{ profit_data.labels|default:"[]"|safe }};
            let profitValues = {{ profit_data.profit_values|default:"[]"|safe }};

            if (profitLabels.length > 0 && profitValues.length > 0) {
                new Chart(profitCtx, {
                    type: "line",
                    data: {
                        labels: profitLabels,
                        datasets: [{
                            label: "Profit Amount ($)",
                            data: profitValues,
                            borderColor: "rgba(255, 99, 132, 1)",
                            backgroundColor: "rgba(255, 99, 132, 0.2)",
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: "rgba(200, 200, 200, 0.2)" }
                            }
                        },
                        plugins: {
                            tooltip: { enabled: true },
                            legend: { display: false }
                        }
                    }
                });
            }
        });
    </script>
{% endblock %}
