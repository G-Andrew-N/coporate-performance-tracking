{% extends 'main.html' %}

{% block content %}
    <h1>Property Management</h1>

    <!-- Search Bar -->
    <form method="get" action="{% url 'property_list' %}" class="search-form">
        <input type="text" name="q" placeholder="Search properties..." value="{{ request.GET.q }}">
        <button type="submit" class="btn">Search</button>
    </form>

    {% if view_mode == "list" %}
        <!-- Action Buttons -->
        <div class="property-list-actions">
            <a href="{% url 'property_add' %}" class="btn">Add New Property</a>
            <a href="{% url 'export_properties' %}" class="btn">Export CSV</a>
        </div>

        <!-- Property List -->
        <ul class="property-list">
            {% for property in page_obj %}
                <li class="property-item">
                    <a href="{% url 'property_detail' property.id %}">{{ property.address }}</a> - {{ property.propertyType }}
                    <div class="property-actions">
                        <a href="{% url 'property_edit' property.id %}" class="btn edit-btn">Edit</a>
                        <a href="{% url 'property_delete' property.id %}" class="btn delete-btn">Delete</a>
                    </div>
                </li>
            {% empty %}
                <p>No properties found.</p>
            {% endfor %}
        </ul>

        <!-- Pagination Controls -->
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1" class="btn">&laquo; First</a>
                <a href="?page={{ page_obj.previous_page_number }}" class="btn">Previous</a>
            {% endif %}

            <span class="current-page">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="btn">Next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}" class="btn">Last &raquo;</a>
            {% endif %}
        </div>
    {% endif %}

    {% if view_mode == "detail" %}
        <div class="property-detail">
            <h2>{{ property.address }} Details</h2>
            
            {% if property.image %}
                <img src="{{ property.image.url }}" alt="{{ property.address }}" class="property-image">
            {% endif %}
            
            <ul class="property-info">
                <li><strong>Type:</strong> {{ property.propertyType }}</li>
                <li><strong>Location:</strong> {{ property.location }}</li>
                <li><strong>Floors:</strong> {{ property.floors }}</li>
                <li><strong>Covered Area:</strong> {{ property.coveredArea }}</li>
                <li><strong>Electricity Status:</strong> {{ property.electricityStatus }}</li>
                <li><strong>Bathrooms:</strong> {{ property.bathroomCount }}</li>
                <li><strong>Bedrooms:</strong> {{ property.bedroomCount }}</li>
                <li><strong>Booking Amount:</strong> {{ property.bookingAmount }}</li>
                <li><strong>Price:</strong> {{ property.price }}</li>
                <li><strong>Status:</strong> {{ property.status }}</li>
            </ul>

            <!-- Update Status -->
            <form method="post" action="{% url 'update_property_status' property.id %}" class="status-form">
                {% csrf_token %}
                <label for="status">Update Status:</label>
                <select name="status" id="status">
                    {% for value, label in property.STATUS_CHOICES %}
                        <option value="{{ value }}" {% if value == property.status %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn">Update</button>
            </form>

            <a href="{% url 'property_list' %}" class="btn">Back to List</a>
        </div>
    {% endif %}

    {% if view_mode in "add edit" %}
        <div class="property-form">
            <h2>{% if view_mode == "add" %}Add Property{% else %}Edit Property{% endif %}</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn">
                    {% if view_mode == "add" %} Add {% else %} Save Changes {% endif %}
                </button>
            </form>
            <a href="{% url 'property_list' %}" class="btn">Back to List</a>
        </div>
    {% endif %}

    {% if view_mode == "delete" %}
        <div class="delete-confirmation">
            <h2>Delete Property</h2>
            <p>Are you sure you want to delete "{{ property.address }}"?</p>
            <form method="post">
                {% csrf_token %}
                <button type="submit" class="btn delete-btn">Yes, Delete</button>
            </form>
            <a href="{% url 'property_list' %}" class="btn">Cancel</a>
        </div>
    {% endif %}
{% endblock %}
