{% extends 'main.html' %}

{% block content %}
    <h1>Property Management</h1>

    <!-- Search Bar -->
    <form method="get" action="{% url 'property_list' %}" class="search-form">
        <input type="text" name="q" placeholder="Search properties..." value="{{ request.GET.q }}">
        <button type="submit" class="btn">Search</button>
    </form>

    {% if view_mode == "list" %}
        <!-- Action Buttons -->
        <div class="property-list-actions">
            <a href="{% url 'property_add' %}" class="btn">Add New Property</a>
            <a href="{% url 'export_properties' %}" class="btn">Export CSV</a>
        </div>

        <!-- Property List -->
        <ul class="property-list">
            {% for property in page_obj %}
                <li class="property-item">
                    <a href="{% url 'property_detail' property.id %}">{{ property.address }}</a> - {{ property.propertyType }}
                    <div class="property-actions">
                        <a href="{% url 'property_edit' property.id %}" class="btn edit-btn">Edit</a>
                        <a href="{% url 'property_delete' property.id %}" class="btn delete-btn">Delete</a>
                    </div>
                </li>
            {% empty %}
                <p>No properties found.</p>
            {% endfor %}
        </ul>

        <!-- Pagination Controls -->
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1" class="btn">&laquo; First</a>
                <a href="?page={{ page_obj.previous_page_number }}" class="btn">Previous</a>
            {% endif %}

            <span class="current-page">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="btn">Next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}" class="btn">Last &raquo;</a>
            {% endif %}
        </div>
    {% endif %}

    {% if view_mode == "detail" %}
        <div class="property-detail">
            <h2>{{ property.address }} Details</h2>
            
            {% if property.image %}
                <img src="{{ property.image.url }}" alt="{{ property.address }}" class="property-image">
            {% endif %}
            
            <ul class="property-info">
                <li><strong>Type:</strong> {{ property.propertyType }}</li>
                <li><strong>Location:</strong> {{ property.location }}</li>
                <li><strong>Floors:</strong> {{ property.floors }}</li>
                <li><strong>Covered Area:</strong> {{ property.coveredArea }}</li>
                <li><strong>Electricity Status:</strong> {{ property.electricityStatus }}</li>
                <li><strong>Bathrooms:</strong> {{ property.bathroomCount }}</li>
                <li><strong>Bedrooms:</strong> {{ property.bedroomCount }}</li>
                <li><strong>Booking Amount:</strong> {{ property.bookingAmount }}</li>
                <li><strong>Price:</strong> {{ property.price }}</li>
                <li><strong>Status:</strong> {{ property.status }}</li>
            </ul>

            <!-- Update Status -->
            <form method="post" action="{% url 'update_property_status' property.id %}" class="status-form">
                {% csrf_token %}
                <label for="status">Update Status:</label>
                <select name="status" id="status">
                    {% for value, label in property.STATUS_CHOICES %}
                        <option value="{{ value }}" {% if value == property.status %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn">Update</button>
            </form>

            <a href="{% url 'property_list' %}" class="btn">Back to List</a>
        </div>
    {% endif %}

    {% if view_mode in "add edit" %}
        <div class="property-form">
            <h2>{% if view_mode == "add" %}Add Property{% else %}Edit Property{% endif %}</h2>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn">
                    {% if view_mode == "add" %} Add {% else %} Save Changes {% endif %}
                </button>
            </form>
            <a href="{% url 'property_list' %}" class="btn">Back to List</a>
        </div>
    {% endif %}

    {% if view_mode == "delete" %}
        <div class="delete-confirmation">
            <h2>Delete Property</h2>
            <p>Are you sure you want to delete "{{ property.address }}"?</p>
            <form method="post">
                {% csrf_token %}
                <button type="submit" class="btn delete-btn">Yes, Delete</button>
            </form>
            <a href="{% url 'property_list' %}" class="btn">Cancel</a>

            <style>
                /* Main Container Styles */
                .content {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 2rem;
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                    background-color: #f7fafc;
                }
                
                h1 {
                    color: #1a365d;
                    font-size: 2rem;
                    font-weight: 600;
                    margin-bottom: 2rem;
                    padding-bottom: 1rem;
                    border-bottom: 2px solid #e2e8f0;
                }
                
                /* Search Form */
                .search-form {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 2rem;
                }
                
                .search-form input[type="text"] {
                    flex: 1;
                    padding: 0.75rem;
                    border: 2px solid #e2e8f0;
                    border-radius: 0.5rem;
                    font-size: 1rem;
                    transition: all 0.2s ease;
                }
                
                .search-form input[type="text"]:focus {
                    outline: none;
                    border-color: #4299e1;
                    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.15);
                }
                
                /* Action Buttons */
                .btn {
                    padding: 0.75rem 1.5rem;
                    border-radius: 0.5rem;
                    font-weight: 500;
                    font-size: 0.875rem;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    text-decoration: none;
                    border: none;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    background-color: #4299e1;
                    color: white;
                }
                
                .btn:hover {
                    background-color: #2b6cb0;
                    transform: translateY(-1px);
                }
                
                .property-list-actions {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 2rem;
                }
                
                /* Property List */
                .property-list {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                }
                
                .property-item {
                    background: white;
                    padding: 1rem 1.5rem;
                    border-radius: 0.5rem;
                    margin-bottom: 1rem;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                    transition: transform 0.2s ease;
                }
                
                .property-item:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                }
                
                .property-item a {
                    color: #2d3748;
                    text-decoration: none;
                    font-weight: 500;
                }
                
                .property-actions {
                    display: flex;
                    gap: 0.5rem;
                }
                
                .edit-btn {
                    background-color: #4299e1;
                }
                
                .delete-btn {
                    background-color: #e53e3e;
                }
                
                /* Pagination */
                .pagination {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 1rem;
                    margin-top: 2rem;
                    padding-top: 2rem;
                    border-top: 2px solid #e2e8f0;
                }
                
                .current-page {
                    color: #4a5568;
                    font-weight: 500;
                }
                
                /* Property Detail View */
                .property-detail {
                    background: white;
                    padding: 2rem;
                    border-radius: 0.75rem;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                }
                
                .property-image {
                    width: 100%;
                    max-height: 400px;
                    object-fit: cover;
                    border-radius: 0.5rem;
                    margin: 1rem 0;
                }
                
                .property-info {
                    list-style: none;
                    padding: 0;
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 1rem;
                    margin: 2rem 0;
                }
                
                .property-info li {
                    padding: 0.75rem;
                    background: #f7fafc;
                    border-radius: 0.375rem;
                    color: #4a5568;
                }
                
                .property-info strong {
                    color: #2d3748;
                    margin-right: 0.5rem;
                }
                
                /* Status Form */
                .status-form {
                    margin: 2rem 0;
                    padding: 1.5rem;
                    background: #f7fafc;
                    border-radius: 0.5rem;
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                
                .status-form select {
                    padding: 0.5rem;
                    border: 2px solid #e2e8f0;
                    border-radius: 0.375rem;
                    background: white;
                }
                
                /* Property Form */
                .property-form {
                    background: white;
                    padding: 2rem;
                    border-radius: 0.75rem;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                }
                
                .property-form form {
                    display: grid;
                    gap: 1.5rem;
                }
                
                .property-form p {
                    margin: 0;
                }
                
                .property-form label {
                    display: block;
                    color: #4a5568;
                    font-weight: 500;
                    margin-bottom: 0.5rem;
                }
                
                .property-form input,
                .property-form select,
                .property-form textarea {
                    width: 100%;
                    padding: 0.75rem;
                    border: 2px solid #e2e8f0;
                    border-radius: 0.5rem;
                    font-size: 1rem;
                }
                
                /* Delete Confirmation */
                .delete-confirmation {
                    background: white;
                    padding: 2rem;
                    border-radius: 0.75rem;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    text-align: center;
                }
                
                .delete-confirmation p {
                    color: #4a5568;
                    margin: 1.5rem 0;
                }
                
                /* Responsive Design */
                @media (max-width: 768px) {
                    .property-list-actions,
                    .search-form {
                        flex-direction: column;
                    }
                
                    .property-item {
                        flex-direction: column;
                        gap: 1rem;
                        text-align: center;
                    }
                
                    .property-info {
                        grid-template-columns: 1fr;
                    }
                
                    .status-form {
                        flex-direction: column;
                        align-items: stretch;
                    }
                
                    .pagination {
                        flex-wrap: wrap;
                        justify-content: center;
                    }
                }
                
                        </style>
                        
        </div>
        
    {% endif %}
{% endblock %}
